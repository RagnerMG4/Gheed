<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¬Ø±Ø¯ Ø¬Ø§Ù…Ø¹Ø© Ø£Ø´ÙˆØ± - Ø¨Ù„ÙŠØ¨Ù„Ø§Øª ÙˆØ§Ø¶Ø­Ø©</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        :root { --primary: #1a3a5f; --accent: #27ae60; --bg: #f8f9fa; --header-bg: #f2f2f2; }
        body { font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 100%; margin: auto; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        .official-header { display: flex; flex-direction: column; align-items: center; text-align: center; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 15px; gap: 8px; }
        @media (min-width: 768px) { .official-header { flex-direction: row; justify-content: space-between; text-align: inherit; } }
        .header-side { font-weight: bold; font-size: 12px; line-height: 1.4; color: #000; }
        .logo-img { width: 75px; height: auto; }

        .tabs { display: flex; gap: 4px; margin-bottom: 15px; background: #eee; padding: 4px; border-radius: 8px; }
        .tab-btn { flex: 1; padding: 14px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px; }
        .tab-btn.active { background: var(--primary); color: white; }

        .page { display: none; }
        .page.active { display: block; }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù„ÙŠØ¨Ù„ ÙˆØ§Ù„Ù…Ø¯Ø®Ù„Ø§Øª */
        .form-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        @media (min-width: 768px) { .form-grid { grid-template-columns: repeat(3, 1fr); } }
        
        .field-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-weight: bold; font-size: 14px; color: #333; margin-right: 5px; }
        input, select, textarea { padding: 12px; border: 1px solid #bbb; border-radius: 8px; font-size: 16px; width: 100%; box-sizing: border-box; background: #fff; }
        
        .save-btn { background: var(--accent); color: white; border: none; padding: 16px; border-radius: 10px; width: 100%; font-weight: bold; font-size: 17px; cursor: pointer; margin-top: 20px; }

        .table-wrapper { overflow-x: auto; border: 1px solid #333; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; min-width: 1300px; }
        th, td { border: 1px solid #000; padding: 10px; text-align: center; vertical-align: middle; font-size: 12px; font-weight: bold; }
        th { background: var(--header-bg); color: #000; }
        
        .preview-img { width: 180px; height: 130px; object-fit: contain; background: #fff; border: 1px solid #ccc; }
        .excel-btn { background: #1d6f42; color: white; border: none; padding: 15px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; margin-bottom: 10px; }
        
        .action-btns { display: flex; flex-direction: column; gap: 5px; }
        .btn-edit { background: #f39c12; color: white; border: none; padding: 8px; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .btn-del { background: #e74c3c; color: white; border: none; padding: 8px; border-radius: 5px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div class="official-header">
        <div class="header-side">Ø¬Ø§Ù…Ø¹Ø© Ø£Ø´ÙˆØ±<br>Ø§Ù„ÙƒÙ„ÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„ØµØ­ÙŠØ© ÙˆØ§Ù„Ø·Ø¨ÙŠØ©<br>Ù‚Ø³Ù… ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</div>
        <div><img src="mon.png" id="web-logo" class="logo-img" alt="Logo"></div>
        <div class="header-side" style="direction: ltr;">ASHUR UNIVERSITY<br>Parasitology Lab<br></div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" id="btn-tab-in" onclick="switchTab('input-page')">Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <button class="tab-btn" id="btn-tab-dis" onclick="switchTab('display-page')">Ø³Ø¬Ù„ Ø§Ù„Ø¬Ø±Ø¯</button>
    </div>

    <div id="input-page" class="page active">
        <input type="hidden" id="edit-idx" value="-1">
        <div class="form-grid">
            <div class="field-group">
                <label>Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² (EN)</label>
                <input type="text" id="name_en" placeholder="Ù…Ø«Ø§Ù„: Centrifuge">
            </div>
            <div class="field-group">
                <label>Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² (Ø¹Ø±Ø¨ÙŠ)</label>
                <input type="text" id="name_ar" placeholder="Ù…Ø«Ø§Ù„: Ø¬Ù‡Ø§Ø² Ø§Ù„Ø·Ø±Ø¯ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ">
            </div>
            <div class="field-group">
                <label>Ø§Ù„Ø¹Ø¯Ø¯</label>
                <input type="number" id="count" placeholder="0">
            </div>
            <div class="field-group">
                <label>Serial number</label>
                <input type="text" id="serial" placeholder="S/N">
            </div>
            <div class="field-group">
                <label>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</label>
                <input type="text" id="usage" value="ØªØ¬Ø§Ø±Ø¨">
            </div>
            <div class="field-group">
                <label>Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²</label>
                <select id="type"><option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ">ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ</option><option value="Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ">Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ</option></select>
            </div>
            <div class="field-group">
                <label>Ø§Ù„Ù…Ù†Ø´Ø£</label>
                <input type="text" id="origin" placeholder="Ù…Ø«Ø§Ù„: Germany">
            </div>
            <div class="field-group">
                <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©</label>
                <input type="text" id="risk" placeholder="Ù…ØªÙˆØ³Ø· / Ø¨Ø¯ÙˆÙ†">
            </div>
            <div class="field-group">
                <label>Ø§Ù„Ø¹Ù…Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø³Ù†Ø©)</label>
                <input type="number" id="life" placeholder="5">
            </div>
            <div class="field-group" style="grid-column: 1 / -1;">
                <label>ÙˆØµÙ Ø§Ù„Ø¬Ù‡Ø§Ø²</label>
                <textarea id="desc" rows="3" placeholder="Ø´Ø±Ø­ Ù…Ø®ØªØµØ± Ø¹Ù† Ø¹Ù…Ù„ Ø§Ù„Ø¬Ù‡Ø§Ø²..."></textarea>
            </div>
            <div class="field-group" style="grid-column: 1 / -1;">
                <label>ØµÙˆØ±Ø© Ø¹Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</label>
                <input type="file" id="img-input" accept="image/*">
            </div>
        </div>
        <button class="save-btn" onclick="saveData()" id="save-btn-label">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¬Ù‡Ø§Ø² ÙÙŠ Ø§Ù„Ø³Ø¬Ù„</button>
    </div>

    <div id="display-page" class="page">
        <button onclick="exportToExcel()" class="excel-btn">ğŸ“¥ ØªØµØ¯ÙŠØ± Ù…Ù„Ù Excel   </button>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Øª</th>
                        <th>Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø§Ù†ÙƒÙ„ÙŠØ²ÙŠØ©</th>
                        <th>Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</th>
                        <th>Ø§Ù„Ø¹Ø¯Ø¯</th>
                        <th>Serial number</th>
                        <th>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</th>
                        <th>Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²</th>
                        <th>Ø§Ù„Ù…Ù†Ø´Ø£</th>
                        <th>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©</th>
                        <th>Ø§Ù„Ø¹Ù…Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</th>
                        <th>ÙˆØµÙ Ø§Ù„Ø¬Ù‡Ø§Ø²</th>
                        <th>ØµÙˆØ±Ø© Ø¹Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</th>
                        <th>Ø§Ù„ØªØ­ÙƒÙ…</th>
                    </tr>
                </thead>
                <tbody id="inventory-body"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('ashur_final_labels')) || [];

    function switchTab(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'display-page') render();
    }

    async function saveData() {
        const file = document.getElementById('img-input').files[0];
        let base64 = document.getElementById('edit-idx').getAttribute('data-img') || "";
        
        if (file) {
            base64 = await new Promise(r => {
                const reader = new FileReader();
                reader.onload = e => r(e.target.result);
                reader.readAsDataURL(file);
            });
        }

        const data = {
            name_en: document.getElementById('name_en').value,
            name_ar: document.getElementById('name_ar').value,
            count: document.getElementById('count').value,
            serial: document.getElementById('serial').value,
            usage: document.getElementById('usage').value,
            type: document.getElementById('type').value,
            origin: document.getElementById('origin').value,
            risk: document.getElementById('risk').value,
            life: document.getElementById('life').value,
            desc: document.getElementById('desc').value,
            image: base64
        };

        const idx = parseInt(document.getElementById('edit-idx').value);
        if(idx === -1) db.push(data); else db[idx] = data;

        localStorage.setItem('ashur_final_labels', JSON.stringify(db));
        resetForm();
        switchTab('display-page');
    }

    function render() {
        const body = document.getElementById('inventory-body');
        body.innerHTML = db.map((item, i) => `
            <tr>
                <td>${i+1}</td>
                <td>${item.name_en}</td>
                <td>${item.name_ar}</td>
                <td>${item.count}</td>
                <td>${item.serial}</td>
                <td>${item.usage}</td>
                <td>${item.type}</td>
                <td>${item.origin}</td>
                <td>${item.risk}</td>
                <td>${item.life}</td>
                <td style="text-align:right;">${item.desc}</td>
                <td><img src="${item.image}" class="preview-img"></td>
                <td class="action-btns">
                    <button class="btn-edit" onclick="editItem(${i})">ØªØ¹Ø¯ÙŠÙ„</button>
                    <button class="btn-del" onclick="deleteItem(${i})">Ø­Ø°Ù</button>
                </td>
            </tr>`).join('');
    }

    function editItem(i) {
        const itm = db[i];
        document.getElementById('name_en').value = itm.name_en;
        document.getElementById('name_ar').value = itm.name_ar;
        document.getElementById('count').value = itm.count;
        document.getElementById('serial').value = itm.serial;
        document.getElementById('usage').value = itm.usage;
        document.getElementById('type').value = itm.type;
        document.getElementById('origin').value = itm.origin;
        document.getElementById('risk').value = itm.risk;
        document.getElementById('life').value = itm.life;
        document.getElementById('desc').value = itm.desc;
        document.getElementById('edit-idx').value = i;
        document.getElementById('edit-idx').setAttribute('data-img', itm.image);
        document.getElementById('save-btn-label').innerText = "ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
        switchTab('input-page');
    }

    function resetForm() {
        document.querySelectorAll('input, textarea').forEach(e => e.value = "");
        document.getElementById('edit-idx').value = "-1";
        document.getElementById('save-btn-label').innerText = "ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¬Ù‡Ø§Ø² ÙÙŠ Ø§Ù„Ø³Ø¬Ù„";
    }

    function deleteItem(i) {
        if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
            db.splice(i, 1);
            localStorage.setItem('ashur_final_labels', JSON.stringify(db));
            render();
        }
    }

    async function exportToExcel() {
        const workbook = new ExcelJS.Workbook();
        const sheet = workbook.addWorksheet('Ø§Ù„Ø¬Ø±Ø¯', { views: [{ rightToLeft: true }] });
        
        sheet.mergeCells('A1:D3');
        sheet.getCell('A1').value = "Ø¬Ø§Ù…Ø¹Ø© Ø§Ø´ÙˆØ±\nØ§Ù„ÙƒÙ„ÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„ØµØ­ÙŠØ© ÙˆØ§Ù„Ø·Ø¨ÙŠØ©\nÙ‚Ø³Ù… ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©";
        sheet.getCell('A1').alignment = { horizontal: 'right', vertical: 'middle', wrapText: true };

                sheet.mergeCells('I1:L3');
        sheet.getCell('I1').value = "ASHUR UNIVERSITY\nParasitology & Biology Lab\n";
        sheet.getCell('I1').alignment = { horizontal: 'left', vertical: 'middle', wrapText: true };
        sheet.getCell('I1').font = { bold: true };

        try {
            
        } catch(e) {}

        const hRow = sheet.getRow(5);
        hRow.values = ["Øª", "Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø§Ù†ÙƒÙ„ÙŠØ²ÙŠØ©", "Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©", "Ø§Ù„Ø¹Ø¯Ø¯", "Serial number", "Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…", "Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²", "Ø§Ù„Ù…Ù†Ø´Ø£", "Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©", "Ø§Ù„Ø¹Ù…Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ", "ÙˆØµÙ Ø§Ù„Ø¬Ù‡Ø§Ø²", "ØµÙˆØ±Ø© Ø¹Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²"];
        hRow.eachCell(c => { 
            c.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFF2F2F2' } };
            c.font = { bold: true }; 
            c.border = { top:{style:'thin'}, left:{style:'thin'}, bottom:{style:'thin'}, right:{style:'thin'} };
            c.alignment = { horizontal: 'center', vertical: 'middle', wrapText: true };
        });

        db.forEach((item, i) => {
            const row = sheet.addRow([i+1, item.name_en, item.name_ar, item.count, item.serial, item.usage, item.type, item.origin, item.risk, item.life, item.desc, ""]);
            row.height = 160;
            row.eachCell(c => { c.alignment = { horizontal: 'center', vertical: 'middle', wrapText: true }; c.border = { top:{style:'thin'}, left:{style:'thin'}, bottom:{style:'thin'}, right:{style:'thin'} }; });
            if (item.image) {
                const imgId = workbook.addImage({ base64: item.image, extension: 'png' });
                sheet.addImage(imgId, { tl: { col: 11, row: row.number - 1 }, ext: { width: 200, height: 190 } });
            }
        });

        sheet.getColumn(11).width = 45; sheet.getColumn(12).width = 35;
        const buffer = await workbook.xlsx.writeBuffer();
        saveAs(new Blob([buffer]), "Ø¬Ø±Ø¯_Ø¬Ø§Ù…Ø¹Ø©_Ø§Ø´ÙˆØ±_Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.xlsx");
    }
</script>

</body>
</html>